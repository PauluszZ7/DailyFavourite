{% extends 'base.html' %}

{% block title %}Gruppeneinstellungen{% endblock %}

{% block content %}
<div class="container mt-4">
  <h2>Gruppeneinstellungen</h2>
  <form method="POST" enctype="multipart/form-data">
    {% csrf_token %}

    <div class="mb-3">
      <label for="name" class="form-label">Name der Gruppe</label>
      <input type="text" name="name" id="name" class="form-control" value="{{ group.name }}" required>
    </div>

    <div class="mb-3">
      <label for="description" class="form-label">Beschreibung</label>
      <textarea name="description" id="description" class="form-control">{{ group.description }}</textarea>
    </div>

    <div class="mb-3">
      <label class="form-label">Gruppenbild</label>
<div id="imagePreview"
     class="rounded-circle bg-light mb-2 d-flex align-items-center justify-content-center"
     style="width: 120px; height: 120px;
            {% if group.profile_Image %}
              background-image: url('{{ group.profile_Image.url }}');
            {% else %}
              background-color: #e9ecef;
            {% endif %}
            background-size: cover;
            background-position: center;
            cursor: pointer;">
  <span id="uploadIcon" class="fs-1 text-secondary m-0">+</span>
</div>

      <input type="file" name="profile_Image" id="profile_Image" class="form-control d-none">
    </div>

    <div class="mb-3">
      <label for="genre" class="form-label">Genre</label>
      <select name="genre" id="genre" class="form-select">
        {% for value, label in group.GENRE_CHOICES %}
          <option value="{{ value }}" {% if group.genre == value %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
      </select>
    </div>

    <div class="mb-3">
      <label class="form-label">Sichtbarkeit</label>
      <div class="btn-group" role="group">
        <input type="radio" class="btn-check" name="is_public" id="publicToggle" value="True" autocomplete="off" {% if group.is_public %}checked{% endif %}>
        <label class="btn btn-outline-primary" for="publicToggle">Öffentlich</label>
        <input type="radio" class="btn-check" name="is_public" id="privateToggle" value="False" autocomplete="off" {% if not group.is_public %}checked{% endif %}>
        <label class="btn btn-outline-primary" for="privateToggle">Privat</label>
      </div>
    </div>

    <div class="mb-3">
      <label for="max_posts_per_day" class="form-label">Maximale Posts pro Tag</label>
      <input type="number" name="max_posts_per_day" id="max_posts_per_day" class="form-control" value="{{ group.max_posts_per_day }}">
    </div>

    <div class="mb-3">
      <label for="post_permission" class="form-label">Wer darf posten?</label>
      <select name="post_permission" id="post_permission" class="form-select">
        {% for value, label in group.PERMISSION_CHOICES %}
          <option value="{{ value }}" {% if group.post_permission == value %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
      </select>
    </div>

    <div class="mb-3">
      <label for="read_permission" class="form-label">Wer darf lesen?</label>
      <select name="read_permission" id="read_permission" class="form-select">
        {% for value, label in group.PERMISSION_CHOICES %}
          <option value="{{ value }}" {% if group.read_permission == value %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
      </select>
    </div>

    <div class="text-end">
      <button type="submit" class="btn btn-primary">Änderungen speichern</button>
    </div>

    <div class="text-end mt-4">
      <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deleteModal">
        Gruppe löschen
      </button>
    </div>
  </form>
</div>

<div class="modal fade" id="deleteModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <form method="POST" action="{% url 'delete_group' group.id %}">
        {% csrf_token %}
        <div class="modal-header">
          <h5 class="modal-title">Gruppe wirklich löschen?</h5>
        </div>
        <div class="modal-body">
          <p>Diese Aktion kann nicht rückgängig gemacht werden!</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Abbrechen</button>
          <button type="submit" class="btn btn-danger">Endgültig löschen</button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
  const imageInput = document.getElementById('profile_Image');
  const preview = document.getElementById('imagePreview');
  const uploadIcon = document.getElementById('uploadIcon');

  preview.addEventListener('click', () => {
    imageInput.click();
  });

  imageInput.addEventListener('change', function () {
    const file = this.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function (e) {
        preview.style.backgroundImage = `url(${e.target.result})`;
        uploadIcon.style.display = "none";
      };
      reader.readAsDataURL(file);
    }
  });
</script>
{% endblock %}
